<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#240046">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>å…¨æ–¹ä½å‘½ç†å¤§å¸«</title>
    
    <style>
        /* --- æ ¸å¿ƒè¨­å®š --- */
        :root {
            --primary: #7b2cbf;
            --bg: #10002b;
            --card: #240046;
            --accent: #ff9e00;
            --text: #ffffff;
            --timeline-line: rgba(255, 158, 0, 0.3);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg); color: var(--text); min-height: 100vh;
            background-image: linear-gradient(160deg, #10002b 0%, #3c096c 100%);
            padding-bottom: 60px;
        }
        .container { width: 100%; max-width: 480px; margin: 0 auto; padding: 20px; }

        /* --- Header --- */
        .header { text-align: center; margin: 15px 0 25px; }
        .logo { font-size: 3.5rem; animation: float 3s ease-in-out infinite; display: inline-block; text-shadow: 0 0 20px rgba(123, 44, 191, 0.6); }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        .title { font-size: 1.8rem; margin: 5px 0; color: #e0aaff; letter-spacing: 1px; font-weight: 800; }
        .subtitle { font-size: 0.9rem; color: #9d4edd; opacity: 0.9; }

        /* --- è¼¸å…¥è¡¨å–® --- */
        .input-card {
            background: rgba(36, 0, 70, 0.6); backdrop-filter: blur(10px);
            padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3); animation: fadeIn 0.8s;
        }
        .form-group { margin-bottom: 20px; }
        .label { display: block; margin-bottom: 8px; color: #c77dff; font-size: 0.95rem; }
        input, select {
            width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #5a189a;
            background: rgba(0,0,0,0.3); color: #fff; font-size: 16px; outline: none; appearance: none;
        }
        .btn-main {
            width: 100%; padding: 16px; border-radius: 50px; border: none;
            background: linear-gradient(90deg, #7b2cbf, #ff9e00); color: white;
            font-size: 1.2rem; font-weight: bold; margin-top: 10px; cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 158, 0, 0.4); transition: transform 0.2s;
        }
        .btn-main:active { transform: scale(0.98); }

        /* --- çµæœèˆ‡ Tabs --- */
        #result-section { display: none; animation: slideUp 0.5s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        .identity-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02));
            border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; padding: 20px;
            display: flex; align-items: center; gap: 15px; margin-bottom: 20px; position: relative; overflow: hidden;
        }
        .star-icon { font-size: 2.5rem; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 50%; }
        .id-info h2 { margin: 0; font-size: 1.6rem; color: var(--accent); }
        .id-info p { margin: 5px 0 0; opacity: 0.8; font-size: 0.9rem; }
        .blood-tag { position: absolute; top: 20px; right: 20px; background: #d00000; font-size: 0.85rem; padding: 4px 10px; border-radius: 6px; font-weight: bold; }

        /* å°è¦½åˆ— */
        .main-tabs { display: flex; background: #1a0b2e; border-radius: 15px; padding: 5px; margin-bottom: 20px; border: 1px solid #3c096c; gap: 5px;}
        .tab-btn { flex: 1; text-align: center; padding: 10px 5px; border-radius: 12px; color: #aaa; cursor: pointer; transition: 0.3s; font-size: 0.95rem; font-weight: 500;}
        .tab-btn.active { background: var(--card); color: var(--accent); font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.3); border: 1px solid var(--accent); }

        .content-view { display: none; }
        .content-view.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* === VIEW 1: ä»Šæ—¥é‹å‹¢ === */
        .daily-box {
            background: var(--card); border-radius: 20px; padding: 20px; margin-bottom: 25px;
            border: 1px solid #5a189a; box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .date-badge { background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; display: inline-block; margin-bottom: 15px; color: #e0aaff; letter-spacing: 1px;}
        .lucky-row { display: flex; justify-content: space-between; margin-bottom: 20px; text-align: center; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 15px;}
        .lucky-item { flex: 1; }
        .lucky-val { font-size: 1.1rem; font-weight: bold; color: var(--accent); display: block; margin-bottom: 5px;}
        .lucky-label { font-size: 0.8rem; opacity: 0.7; }
        .daily-msg { line-height: 1.6; font-size: 1rem; color: #eee; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; text-align: justify;}

        /* å¡”ç¾… */
        .tarot-section {
            background: linear-gradient(180deg, #2d0036 0%, #19002e 100%);
            border-radius: 20px; padding: 25px 20px; text-align: center;
            border: 2px solid #ffd700; position: relative; overflow: hidden; box-shadow: 0 0 25px rgba(255, 215, 0, 0.15);
        }
        .tarot-title { color: #ffd700; font-size: 1.3rem; margin-bottom: 15px; font-weight: bold; letter-spacing: 2px;}
        .card-scene { width: 140px; height: 220px; perspective: 1000px; margin: 0 auto 20px; cursor: pointer; }
        .card-obj { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .card-obj.is-flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .card-back { background: radial-gradient(circle, #4a148c 0%, #1a0b2e 100%); border: 3px solid #ffd700; }
        .card-back::after { content: "â˜…"; font-size: 4rem; color: #ffd700; opacity: 0.3; }
        .card-front { background: #fff; color: #333; transform: rotateY(180deg); border: 4px solid #ffd700; }
        .tarot-img { font-size: 5rem; margin-bottom: 10px; }
        .tarot-desc-box { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; text-align: left; display: none; animation: fadeIn 1s; margin-top: 15px;}
        .tarot-btn { background: transparent; border: 1px solid #ffd700; color: #ffd700; padding: 8px 25px; border-radius: 20px; margin-top: 15px; cursor: pointer; font-size: 0.9rem;}

        /* === VIEW 2: æ˜Ÿåº§åˆ†æ (æ–°å¢) === */
        .zodiac-card {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            border-radius: 20px; padding: 25px; text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        .zodiac-icon { font-size: 4rem; margin-bottom: 10px; display: block; animation: float 4s infinite;}
        .zodiac-name { font-size: 1.8rem; font-weight: bold; color: #e0aaff; margin-bottom: 5px; }
        .zodiac-date { font-size: 0.9rem; color: #aaa; background: rgba(0,0,0,0.3); padding: 3px 10px; border-radius: 10px; }
        .zodiac-tags { display: flex; justify-content: center; gap: 10px; margin: 15px 0; flex-wrap: wrap;}
        .z-tag { background: rgba(255,255,255,0.1); padding: 5px 12px; border-radius: 8px; font-size: 0.9rem; color: #fff;}
        .z-tag.fire { border: 1px solid #ff4d4d; color: #ff9999; }
        .z-tag.water { border: 1px solid #4d94ff; color: #99ccff; }
        .z-tag.wind { border: 1px solid #66ff66; color: #ccffcc; }
        .z-tag.earth { border: 1px solid #ffcc00; color: #ffff99; }

        .rating-box { background: rgba(0,0,0,0.2); border-radius: 15px; padding: 15px; margin-top: 20px; text-align: left; }
        .rate-row { display: flex; justify-content: space-between; margin-bottom: 10px; align-items: center; }
        .rate-label { font-size: 1rem; color: #ccc; }
        .stars { color: #ffd700; letter-spacing: 2px; }
        .zodiac-desc { text-align: left; line-height: 1.6; color: #ddd; margin-top: 15px; font-size: 0.95rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;}
        .match-box { margin-top: 15px; background: rgba(255, 158, 0, 0.1); padding: 10px; border-radius: 10px; color: var(--accent); font-weight: bold; font-size: 0.9rem;}

        /* === VIEW 3: äººç”Ÿæµå¹´ === */
        .sub-nav { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 25px; }
        .sub-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: #bbb; padding: 12px 0; border-radius: 10px; font-size: 0.9rem; cursor: pointer; text-align: center; transition: 0.3s;
        }
        .sub-btn.active { background: var(--primary); color: white; border-color: var(--accent); box-shadow: 0 0 15px rgba(123, 44, 191, 0.6); transform: translateY(-2px); font-weight: bold;}

        .timeline { padding-left: 10px; }
        .tl-item { position: relative; padding-left: 35px; margin-bottom: 35px; border-left: 2px solid var(--timeline-line); }
        .tl-item:last-child { border-left: 2px solid transparent; }
        .tl-dot { position: absolute; left: -9px; top: 0; width: 16px; height: 16px; border-radius: 50%; background: var(--bg); border: 3px solid var(--accent); box-shadow: 0 0 15px var(--accent); }
        .tl-time { font-size: 0.85rem; color: var(--accent); margin-bottom: 5px; font-weight: bold; letter-spacing: 1px; text-transform: uppercase; }
        .tl-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; color: #fff; }
        .tl-content { font-size: 1rem; line-height: 1.7; color: #d0d0d0; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; }

        /* Loading */
        .loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(16, 0, 43, 0.98); display: none;
            justify-content: center; align-items: center; flex-direction: column; z-index: 999;
        }
        .spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s infinite linear; margin-bottom: 20px;}
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <span class="logo">ğŸ”®</span>
            <h1 class="title">å…¨æ–¹ä½å‘½ç†å¤§å¸«</h1>
            <div class="subtitle">ç´«å¾® â€§ æ˜Ÿåº§ â€§ å¡”ç¾… â€§ åŸºå› </div>
        </div>

        <!-- è¼¸å…¥è¡¨å–® -->
        <div class="input-card" id="input-form">
            <div class="form-group">
                <label class="label">å§“å</label>
                <input type="text" id="username" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
            </div>
            <div class="form-group">
                <label class="label">è¡€å‹</label>
                <select id="blood">
                    <option value="A">A å‹</option>
                    <option value="B">B å‹</option>
                    <option value="O">O å‹</option>
                    <option value="AB">AB å‹</option>
                </select>
            </div>
            <div class="form-group">
                <label class="label">å‡ºç”Ÿæ—¥æœŸ</label>
                <input type="date" id="birthdate">
            </div>
            <div class="form-group">
                <label class="label">å‡ºç”Ÿæ™‚è¾°</label>
                <select id="birthtime">
                    <option value="23">å­æ™‚ (23-01)</option>
                    <option value="1">ä¸‘æ™‚ (01-03)</option>
                    <option value="3">å¯…æ™‚ (03-05)</option>
                    <option value="5">å¯æ™‚ (05-07)</option>
                    <option value="7">è¾°æ™‚ (07-09)</option>
                    <option value="9">å·³æ™‚ (09-11)</option>
                    <option value="11">åˆæ™‚ (11-13)</option>
                    <option value="13">æœªæ™‚ (13-15)</option>
                    <option value="15">ç”³æ™‚ (15-17)</option>
                    <option value="17">é…‰æ™‚ (17-19)</option>
                    <option value="19">æˆŒæ™‚ (19-21)</option>
                    <option value="21">äº¥æ™‚ (21-23)</option>
                </select>
            </div>
            <button class="btn-main" onclick="analyze()">å•Ÿå‹•å…¨æ–¹ä½é‹ç®—</button>
        </div>

        <!-- çµæœé¡¯ç¤ºå€ -->
        <div id="result-section">
            
            <!-- èº«ä»½å¡ -->
            <div class="identity-card">
                <div class="star-icon">ğŸŒŸ</div>
                <div class="id-info">
                    <h2 id="user-star">ç´«å¾®æ˜Ÿ</h2>
                    <p id="user-desc">äº”è¡Œå±¬åœŸ â€§ å¸ç‹ä¹‹ç›¸</p>
                </div>
                <span class="blood-tag" id="user-blood">A å‹</span>
            </div>

            <!-- ä¸»é ç±¤ -->
            <div class="main-tabs">
                <div class="tab-btn active" onclick="switchMainTab('daily')">ğŸ“… ä»Šæ—¥</div>
                <div class="tab-btn" onclick="switchMainTab('zodiac')">ğŸŒŒ æ˜Ÿåº§</div>
                <div class="tab-btn" onclick="switchMainTab('life')">ğŸ”® æµå¹´</div>
            </div>

            <!-- VIEW 1: ä»Šæ—¥é‹å‹¢ -->
            <div id="view-daily" class="content-view active">
                <div class="daily-box">
                    <span class="date-badge" id="today-date">2023/01/01</span>
                    <div class="lucky-row">
                        <div class="lucky-item"><span class="lucky-val" id="d-color">é‡‘è‰²</span><span class="lucky-label">å¹¸é‹è‰²</span></div>
                        <div class="lucky-item"><span class="lucky-val" id="d-num">8</span><span class="lucky-label">å¹¸é‹æ•¸</span></div>
                        <div class="lucky-item"><span class="lucky-val" id="d-dir">åŒ—æ–¹</span><span class="lucky-label">å‰æ–¹ä½</span></div>
                    </div>
                    <div class="daily-msg" id="d-advice">æ­£åœ¨è®€å–æ˜Ÿè±¡...</div>
                </div>

                <div class="tarot-section">
                    <div class="tarot-title">ğŸƒ æ¯æ—¥å¡”ç¾…æŒ‡å¼•</div>
                    <div class="card-scene" onclick="flipTarot()">
                        <div class="card-obj" id="tarot-obj">
                            <div class="card-face card-back"></div>
                            <div class="card-face card-front">
                                <div class="tarot-img" id="tarot-img">ğŸ©</div>
                                <div class="tarot-name" id="tarot-name">é­”è¡“å¸«</div>
                            </div>
                        </div>
                    </div>
                    <div class="tarot-desc-box" id="tarot-desc-box">
                        <strong style="color:#ffd700; display:block; margin-bottom:8px;">ğŸ”® ç‰Œç¾©ï¼š</strong>
                        <span id="tarot-desc" style="color:#eee;"></span>
                        <div style="text-align:center;"><button class="tarot-btn" onclick="resetTarot(event)">â†º é‡æ–°æ´—ç‰Œ</button></div>
                    </div>
                </div>
            </div>

            <!-- VIEW 2: æ˜Ÿåº§åˆ†æ (NEW) -->
            <div id="view-zodiac" class="content-view">
                <div class="zodiac-card">
                    <span class="zodiac-icon" id="z-icon">â™ˆ</span>
                    <div class="zodiac-name" id="z-name">ç‰¡ç¾Šåº§</div>
                    <span class="zodiac-date" id="z-date">3/21 - 4/19</span>
                    
                    <div class="zodiac-tags">
                        <span class="z-tag fire" id="z-element">ç«è±¡</span>
                        <span class="z-tag" id="z-trait1">ç†±æƒ…</span>
                        <span class="z-tag" id="z-trait2">è¡å‹•</span>
                    </div>

                    <div class="rating-box">
                        <div class="rate-row"><span class="rate-label">â¤ï¸ æ„›æƒ…é‹å‹¢</span><span class="stars" id="z-love-star">â˜…â˜…â˜…â˜…â˜†</span></div>
                        <div class="rate-row"><span class="rate-label">ğŸ’¼ å·¥ä½œäº‹æ¥­</span><span class="stars" id="z-work-star">â˜…â˜…â˜…â˜†â˜†</span></div>
                        <div class="rate-row"><span class="rate-label">ğŸ’° è²¡é‹æŒ‡æ•¸</span><span class="stars" id="z-money-star">â˜…â˜…â˜…â˜…â˜…</span></div>
                    </div>

                    <div class="zodiac-desc" id="z-desc">
                        åˆ†æä¸­...
                    </div>
                    
                    <div class="match-box" id="z-match">
                        ğŸ’˜ é€Ÿé…å°è±¡ï¼šç…å­åº§ã€å°„æ‰‹åº§
                    </div>
                </div>
            </div>

            <!-- VIEW 3: äººç”Ÿæµå¹´ -->
            <div id="view-life" class="content-view">
                <div class="sub-nav">
                    <div class="sub-btn active" onclick="switchLifeSubTab('career')">ğŸ’¼ äº‹æ¥­</div>
                    <div class="sub-btn" onclick="switchLifeSubTab('love')">â¤ï¸ æ„Ÿæƒ…</div>
                    <div class="sub-btn" onclick="switchLifeSubTab('family')">ğŸ  å®¶åº­</div>
                    <div class="sub-btn" onclick="switchLifeSubTab('health')">ğŸ’ª å¥åº·</div>
                </div>
                <div class="timeline">
                    <div class="tl-item">
                        <div class="tl-dot"></div>
                        <div class="tl-time">PAST â€§ å…ˆå¤©åŸºå› </div>
                        <div class="tl-title">æ—©å¹´é‹ç¨‹</div>
                        <div class="tl-content" id="tl-past">åˆ†æä¸­...</div>
                    </div>
                    <div class="tl-item">
                        <div class="tl-dot"></div>
                        <div class="tl-time">PRESENT â€§ ç•¶ä¸‹æ©Ÿé‡</div>
                        <div class="tl-title">è¿‘æœŸç™¼å±•</div>
                        <div class="tl-content" id="tl-present">åˆ†æä¸­...</div>
                    </div>
                    <div class="tl-item">
                        <div class="tl-dot"></div>
                        <div class="tl-time">FUTURE â€§ å‘½é‹å±•æœ›</div>
                        <div class="tl-title">æœªä¾†èµ°å‘</div>
                        <div class="tl-content" id="tl-future">åˆ†æä¸­...</div>
                    </div>
                </div>
            </div>

            <button onclick="location.reload()" style="width:100%; padding:15px; background:transparent; border:1px solid #666; color:#aaa; border-radius:12px; margin-top:30px; font-size:1rem;">â†º é‡æ–°è¼¸å…¥è³‡æ–™</button>
        </div>
    </div>

    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p style="color:white; margin-top:15px; font-weight:bold; letter-spacing:1px;">å…¨æ–¹ä½æ•¸æ“šé‹ç®—ä¸­...</p>
    </div>

    <script>
        // --- 1. ç´«å¾® & è¡€å‹è³‡æ–™åº« ---
        const starTraits = {
            "ç´«å¾®æ˜Ÿ": { type: "åœŸ", career: "é ˜å°çµ±å¾¡/å‰µæ¥­ç®¡ç†", love: "çœ¼å…‰é«˜/ä¸»å°æ¬Šå¼·", family: "ä¸€å®¶ä¹‹ä¸»/è²¬ä»»é‡å¤§", health: "è„¾èƒƒ/ç²¾ç¥å£“åŠ›" },
            "å¤©æ©Ÿæ˜Ÿ": { type: "æœ¨", career: "ä¼åŠƒåˆ†æ/ç§‘æŠ€ç ”ç™¼", love: "å¿ƒæ€ç´°è†©/å®¹æ˜“å¤šç–‘", family: "å…„å¼Ÿç·£ä½³/è®Šå‹•è¼ƒå¤š", health: "ç¥ç¶“ç³»çµ±/å››è‚¢" },
            "å¤ªé™½æ˜Ÿ": { type: "ç«", career: "å¤–äº¤å…¬é—œ/ç†±å¿ƒåŠ©äºº", love: "ç†±æƒ…ç›´æ¥/ä»˜å‡ºè¼ƒå¤š", family: "çˆ¶æ…ˆå­å­/å…‰è€€é–€æ¥£", health: "å¿ƒè¡€ç®¡/çœ¼éƒ¨" },
            "æ­¦æ›²æ˜Ÿ": { type: "é‡‘", career: "é‡‘èæŠ•è³‡/å¯¦æ¥­å®¶", love: "å‰›æ¯…æœ¨è¨¥/å°‘é»æµªæ¼«", family: "ç®¡æ•™åš´æ ¼/è²¡æ¬Šåœ¨æ¡", health: "å‘¼å¸ç³»çµ±/éª¨éª¼" },
            "å¤©åŒæ˜Ÿ": { type: "æ°´", career: "ä¼‘é–’ç”¢æ¥­/è¡Œæ”¿åº¶å‹™", love: "æº«æŸ”è¢«å‹•/å®¹æ˜“æ„Ÿå‹•", family: "ç›¸è™•èæ´½/æœ‰ç¦æ°£", health: "è…è‡Ÿ/æ°´è…«" },
            "å»‰è²æ˜Ÿ": { type: "ç«", career: "è—è¡“è¨­è¨ˆ/ç²¾å¯†ä½œæ¥­", love: "æ„›æ¨åˆ†æ˜/ä½”æœ‰æ¬²å¼·", family: "è¦ªæƒ…æ¿ƒåš/æƒ…ç·’èµ·ä¼", health: "å¿ƒç«æ—º/å¤±çœ " },
            "å¤©åºœæ˜Ÿ": { type: "åœŸ", career: "åº«æˆ¿ç®¡ç†/åœ°ç”¢ç¶“ç‡Ÿ", love: "é‡è¦–æ¢ä»¶/ç´°æ°´é•·æµ", family: "è³¼ç½®ç”°ç”¢/å®¶åº­å¯Œè¶³", health: "è„¾èƒƒ/æ¶ˆåŒ–ç³»çµ±" },
            "å¤ªé™°æ˜Ÿ": { type: "æ°´", career: "è²¡å‹™æœƒè¨ˆ/æˆ¿ç”¢æŠ•è³‡", love: "æº«æŸ”å©‰ç´„/è¿½æ±‚æµªæ¼«", family: "é‡è¦–æ•´æ½”/å±…å®¶ç”Ÿæ´»", health: "å©¦ç§‘/å…§åˆ†æ³Œ" },
            "è²ªç‹¼æ˜Ÿ": { type: "æ°´", career: "æ¼”è—å¨›æ¨‚/æ¥­å‹™è¡ŒéŠ·", love: "å¤šé‡‡å¤šå§¿/ç•°æ€§ç·£ä½³", family: "ç¤¾äº¤é »ç¹/é–‹æ”¾é–‹æ˜", health: "è‚è†½/é—œç¯€" },
            "å·¨é–€æ˜Ÿ": { type: "æ°´", career: "å¾‹å¸«æ³•å‹™/è©•è«–åˆ†æ", love: "æºé€šéšœç¤™/æ˜“ç”Ÿå£è§’", family: "æ„è¦‹è¼ƒå¤š/éœ€å¤šå‚¾è½", health: "å‘¼å¸é“/å£è…”" },
            "å¤©ç›¸æ˜Ÿ": { type: "æ°´", career: "ç§˜æ›¸ç‰¹åŠ©/å½¢è±¡ç®¡ç†", love: "å¤–è²Œå”æœƒ/é«”è²¼å…¥å¾®", family: "å’Œæ¨‚èè/äº’ç›¸æ‰¶æŒ", health: "çš®è†š/è…è‡Ÿ" },
            "å¤©æ¢æ˜Ÿ": { type: "åœŸ", career: "é†«ç™‚æœå‹™/é¡§å•æŒ‡å°", love: "è€å¤«å°‘å¦»/æˆç†Ÿç©©é‡", family: "é•·å¹¼æœ‰åº/å‚³çµ±ä¿å®ˆ", health: "è„Šæ¤/æ…¢æ€§ç—…" },
            "ä¸ƒæ®ºæ˜Ÿ": { type: "é‡‘", career: "æ¥­å‹™é–‹ç™¼/ç¨ç«‹å‰µæ¥­", love: "æ•¢æ„›æ•¢æ¨/å€‹æ€§å‰›çƒˆ", family: "èšå°‘é›¢å¤š/ç¨ç«‹è‡ªä¸»", health: "å¤–å‚·/å¤§è…¸" },
            "ç ´è»æ˜Ÿ": { type: "æ°´", career: "å‰µæ„è¨­è¨ˆ/ç ´èˆŠç«‹æ–°", love: "å–œæ–°å­èˆŠ/è½Ÿè½Ÿçƒˆçƒˆ", family: "è®Šå‹•æ¬é·/ä»£æºè¼ƒæ·±", health: "è…è‡Ÿ/å¿ƒè‡Ÿ" }
        };

        const textTemplates = {
            career: { past: "æ—©å¹´å³å±•ç¾ã€{Trait}ã€‘çš„æ½›è³ªï¼ŒåŸºç¤ç´®å¯¦ã€‚", present: "ç›®å‰è™•æ–¼é—œéµæœŸï¼Œã€{Trait}ã€‘ç‰¹è³ªåŠ©ä½ ç¨ç•¶ä¸€é¢ã€‚", future: "æœªä¾†æ ¼å±€å®å¤§ï¼Œé©åˆå¾€ã€{Trait}ã€‘é ˜åŸŸæ·±è€•ã€‚" },
            love: { past: "éå»æ„Ÿæƒ…è¼ƒç‚ºã€{Trait}ã€‘ï¼Œç¶“æ­·è®“ä½ æ›´æ‡‚è‡ªå·±ã€‚", present: "è¿‘æœŸæ¡ƒèŠ±èˆ‡ã€{Trait}ã€‘æœ‰é—œï¼Œå»ºè­°å¤šåƒèˆ‡ç¤¾äº¤ã€‚", future: "æœªä¾†æ„Ÿæƒ…è¶¨æ–¼ç©©å®šï¼Œã€{Trait}ã€‘ç‰¹è³ªå°‡è½‰åŒ–ç‚ºæ·±æƒ…ã€‚" },
            family: { past: "åŸç”Ÿå®¶åº­ã€{Trait}ã€‘æ°›åœé€ å°±äº†ä½ ã€‚", present: "å®¶åº­æ˜¯ä½ å¾Œç›¾ï¼Œé›–å¶æœ‰ã€{Trait}ã€‘ä½†é‹å‹¢å‘ä¸Šã€‚", future: "æ™šå¹´äº«å¤©å€«ï¼Œã€{Trait}ã€‘è§€å¿µå‚³æ‰¿ä¸‹ä¸€ä»£ã€‚" },
            health: { past: "å¹¼å¹´éœ€æ³¨æ„ã€{Trait}ã€‘å°æ¯›ç—…ã€‚", present: "å£“åŠ›å¤§æ˜“å¼•ç™¼ã€{Trait}ã€‘ä¸é©ï¼Œéœ€èª¿æ•´ä½œæ¯ã€‚", future: "éš¨è‘—å¹´é½¡å¢é•·ï¼Œéœ€ç‰¹åˆ¥ä¿é¤Šã€{Trait}ã€‘éƒ¨ä½ã€‚" }
        };

        // --- 2. å¡”ç¾…è³‡æ–™åº« ---
        const tarotDeck = [
            { name: "æ„šè€…", icon: "ğŸ¤¡", desc: "å¤§è†½é‚å‡ºç¬¬ä¸€æ­¥ï¼Œä¸è¦ç•æ‡¼æœªçŸ¥çš„æŒ‘æˆ°ã€‚" },
            { name: "é­”è¡“å¸«", icon: "ğŸ©", desc: "ä½ æ“æœ‰å¯¦ç¾ç›®æ¨™æ‰€éœ€çš„ä¸€åˆ‡è³‡æºï¼Œç™¼æ®ä½ çš„æ‰èƒ½å§ã€‚" },
            { name: "å¥³ç¥­å¸", icon: "ğŸ“œ", desc: "éœä¸‹å¿ƒä¾†å‚¾è½å…§å¿ƒçš„è²éŸ³ï¼Œç­”æ¡ˆåœ¨æ½›æ„è­˜è£¡ã€‚" },
            { name: "å¥³çš‡", icon: "ğŸ‘¸", desc: "äº«å—ç”Ÿæ´»ä¸­çš„ç¾å¥½èˆ‡å¯Œè¶³ï¼Œå……æ»¿å‰µé€ åŠ›çš„æ—¥å­ã€‚" },
            { name: "çš‡å¸", icon: "ğŸ‘‘", desc: "å±•ç¾é ˜å°åŠ›èˆ‡è‡ªå¾‹ï¼Œå»ºç«‹ç©©å›ºçš„åŸºç¤ã€‚" },
            { name: "æˆ°è»Š", icon: "ğŸ›’", desc: "åªè¦å …æŒåˆ°åº•ï¼Œå…‹æœéšœç¤™ï¼Œå‹åˆ©çµ‚å°‡å±¬æ–¼ä½ ã€‚" },
            { name: "å‘½é‹ä¹‹è¼ª", icon: "ğŸ¡", desc: "é †å‹¢è€Œç‚ºï¼Œå¹¸é‹å¥³ç¥æ­£åœ¨å‘ä½ å¾®ç¬‘ï¼ŒæŠŠæ¡è½‰æ©Ÿã€‚" },
            { name: "å¤ªé™½", icon: "â˜€ï¸", desc: "å……æ»¿æ´»åŠ›èˆ‡å–œæ‚…çš„ä¸€å¤©ï¼Œæ‰€æœ‰çš„é™°éœ¾éƒ½å°‡ä¸€æƒè€Œç©ºã€‚" }
        ];

        // --- 3. æ˜Ÿåº§è³‡æ–™åº« (NEW) ---
        const zodiacData = [
            { name: "æ‘©ç¾¯åº§", date: "12/22-01/19", icon: "â™‘", el: "earth", elName: "åœŸè±¡", traits: ["å …æ¯…", "å‹™å¯¦"], desc: "æ‘©ç¾¯åº§æ˜¯å¤©ç”Ÿçš„å¯¦è¸å®¶ï¼Œä»Šæ—¥ä½ çš„è€å¿ƒå°‡å¸¶ä¾†å›å ±ã€‚", match: "é‡‘ç‰›åº§ã€è™•å¥³åº§" },
            { name: "æ°´ç“¶åº§", date: "01/20-02/18", icon: "â™’", el: "wind", elName: "é¢¨è±¡", traits: ["å‰µæ–°", "ç¨ç«‹"], desc: "æ€ç¶­è·³èºçš„ä¸€å¤©ï¼Œé©åˆæƒ³äº›æ–°é»å­ï¼Œåˆ¥å¤ªåœ¨æ„ä»–äººçœ¼å…‰ã€‚", match: "é›™å­åº§ã€å¤©ç§¤åº§" },
            { name: "é›™é­šåº§", date: "02/19-03/20", icon: "â™“", el: "water", elName: "æ°´è±¡", traits: ["æµªæ¼«", "ç›´è¦º"], desc: "æ„Ÿæ€§å¤§çˆ†ç™¼ï¼Œé©åˆå‰µä½œæˆ–è«‡å ´æˆ€æ„›ï¼Œç›´è¦ºéå¸¸æº–ã€‚", match: "å·¨èŸ¹åº§ã€å¤©è åº§" },
            { name: "ç‰¡ç¾Šåº§", date: "03/21-04/19", icon: "â™ˆ", el: "fire", elName: "ç«è±¡", traits: ["ç†±æƒ…", "è¡å‹•"], desc: "è¡Œå‹•åŠ›æ»¿é»ï¼Œä»Šæ—¥é©åˆé–‹å•Ÿæ–°è¨ˆç•«ï¼Œè¡å°±å°äº†ï¼", match: "ç…å­åº§ã€å°„æ‰‹åº§" },
            { name: "é‡‘ç‰›åº§", date: "04/20-05/20", icon: "â™‰", el: "earth", elName: "åœŸè±¡", traits: ["ç©©é‡", "äº«å—"], desc: "è²¡é‹ä¸éŒ¯ï¼Œé©åˆåƒé “ç¾é£ŸçŠ’è³è‡ªå·±ï¼Œäº«å—æ…¢æ´»ç¯€å¥ã€‚", match: "æ‘©ç¾¯åº§ã€è™•å¥³åº§" },
            { name: "é›™å­åº§", date: "05/21-06/21", icon: "â™Š", el: "wind", elName: "é¢¨è±¡", traits: ["æ©Ÿæ™º", "å–„è®Š"], desc: "ç¤¾äº¤é‹å‹¢å¼·ï¼Œä½ çš„å£æ‰å°‡ç‚ºä½ å¸¶ä¾†æ„æƒ³ä¸åˆ°çš„æ©Ÿæœƒã€‚", match: "æ°´ç“¶åº§ã€å¤©ç§¤åº§" },
            { name: "å·¨èŸ¹åº§", date: "06/22-07/22", icon: "â™‹", el: "water", elName: "æ°´è±¡", traits: ["é¡§å®¶", "æ•æ„Ÿ"], desc: "é©åˆå®…åœ¨å®¶æˆ–é™ªä¼´å®¶äººï¼Œå®‰å…¨æ„Ÿæ˜¯ä½ ä»Šæ—¥èƒ½é‡çš„ä¾†æºã€‚", match: "å¤©è åº§ã€é›™é­šåº§" },
            { name: "ç…å­åº§", date: "07/23-08/22", icon: "â™Œ", el: "fire", elName: "ç«è±¡", traits: ["è‡ªä¿¡", "éœ¸æ°£"], desc: "ä½ æ˜¯çœ¾äººçš„ç„¦é»ï¼Œå±•ç¾è‡ªä¿¡èƒ½è®“ä½ ç„¡å¾€ä¸åˆ©ã€‚", match: "ç‰¡ç¾Šåº§ã€å°„æ‰‹åº§" },
            { name: "è™•å¥³åº§", date: "08/23-09/22", icon: "â™", el: "earth", elName: "åœŸè±¡", traits: ["å®Œç¾", "ç´°å¿ƒ"], desc: "ç´°ç¯€æ±ºå®šæˆæ•—ï¼Œä½ çš„ç´°å¿ƒå°‡å¹«ä½ é¿é–‹å¤§éŒ¯èª¤ã€‚", match: "é‡‘ç‰›åº§ã€æ‘©ç¾¯åº§" },
            { name: "å¤©ç§¤åº§", date: "09/23-10/23", icon: "â™", el: "wind", elName: "é¢¨è±¡", traits: ["å„ªé›…", "å¹³è¡¡"], desc: "äººéš›é—œä¿‚å’Œè«§ï¼Œé©åˆè«‡åˆ¤æˆ–ç´„æœƒï¼Œå±•ç¾ä½ çš„å„ªé›…é­…åŠ›ã€‚", match: "é›™å­åº§ã€æ°´ç“¶åº§" },
            { name: "å¤©è åº§", date: "10/24-11/22", icon: "â™", el: "water", elName: "æ°´è±¡", traits: ["ç¥ç§˜", "åŸ·è‘—"], desc: "æ´å¯ŸåŠ›æ•éŠ³ï¼Œèƒ½çœ‹ç©¿äº‹ç‰©çš„æœ¬è³ªï¼Œé©åˆåšæ·±åº¦æ€è€ƒã€‚", match: "å·¨èŸ¹åº§ã€é›™é­šåº§" },
            { name: "å°„æ‰‹åº§", date: "11/23-12/21", icon: "â™", el: "fire", elName: "ç«è±¡", traits: ["è‡ªç”±", "æ¨‚è§€"], desc: "é©åˆè¦åŠƒæ—…è¡Œæˆ–å­¸ç¿’æ–°çŸ¥ï¼Œè‡ªç”±çš„ç©ºæ°£è®“ä½ æ´»åŠ›æ»¿æ»¿ã€‚", match: "ç‰¡ç¾Šåº§ã€ç…å­åº§" }
        ];

        let currentStar = "ç´«å¾®æ˜Ÿ";
        let currentBlood = "A";
        let currentLifeTab = "career";
        let isFlipped = false;

        // --- ä¸»ç¨‹å¼ ---
        function analyze() {
            const name = document.getElementById('username').value;
            const date = document.getElementById('birthdate').value;
            const time = parseInt(document.getElementById('birthtime').value);
            const blood = document.getElementById('blood').value;

            if (!date) { alert("è«‹è¼¸å…¥å‡ºç”Ÿæ—¥æœŸ"); return; }

            document.getElementById('input-form').style.display = 'none';
            document.getElementById('loader').style.display = 'flex';

            setTimeout(() => {
                calculateAll(name, date, time, blood);
                document.getElementById('loader').style.display = 'none';
                document.getElementById('result-section').style.display = 'block';
            }, 1200);
        }

        function calculateAll(name, dateStr, time, blood) {
            const d = new Date(dateStr);
            // ç´«å¾®è¨ˆç®— (æ¨¡æ“¬)
            const seed = d.getFullYear() + d.getMonth() + d.getDate() + time + blood.length;
            const starKeys = Object.keys(starTraits);
            currentStar = starKeys[seed % starKeys.length];
            currentBlood = blood;
            const starInfo = starTraits[currentStar];

            // 1. å¡«å¯«èº«ä»½å¡
            document.getElementById('user-star').innerText = currentStar;
            document.getElementById('user-desc').innerText = `äº”è¡Œå±¬${starInfo.type} â€§ ${blood}å‹ç‰¹è³ª`;
            document.getElementById('user-blood').innerText = blood + "å‹";

            // 2. æ›´æ–°ä»Šæ—¥é‹å‹¢
            updateDailyView(seed);
            
            // 3. æ›´æ–°æµå¹´
            updateLifeTimeline("career");

            // 4. è¨ˆç®—æ˜Ÿåº§ (NEW)
            updateZodiacView(d);
        }

        // æ˜Ÿåº§è¨ˆç®—é‚è¼¯
        function updateZodiacView(date) {
            const month = date.getMonth() + 1;
            const day = date.getDate();
            let index = 0;
            
            // ç°¡å–®æ˜Ÿåº§åˆ¤æ–·
            if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) index = 1; // æ°´ç“¶
            else if ((month == 2 && day >= 19) || (month == 3 && day <= 20)) index = 2; // é›™é­š
            else if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) index = 3; // ç‰¡ç¾Š
            else if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) index = 4; // é‡‘ç‰›
            else if ((month == 5 && day >= 21) || (month == 6 && day <= 21)) index = 5; // é›™å­
            else if ((month == 6 && day >= 22) || (month == 7 && day <= 22)) index = 6; // å·¨èŸ¹
            else if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) index = 7; // ç…å­
            else if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) index = 8; // è™•å¥³
            else if ((month == 9 && day >= 23) || (month == 10 && day <= 23)) index = 9; // å¤©ç§¤
            else if ((month == 10 && day >= 24) || (month == 11 && day <= 22)) index = 10; // å¤©è 
            else if ((month == 11 && day >= 23) || (month == 12 && day <= 21)) index = 11; // å°„æ‰‹
            else index = 0; // æ‘©ç¾¯

            const z = zodiacData[index];
            document.getElementById('z-icon').innerText = z.icon;
            document.getElementById('z-name').innerText = z.name;
            document.getElementById('z-date').innerText = z.date;
            
            const elTag = document.getElementById('z-element');
            elTag.innerText = z.elName;
            elTag.className = `z-tag ${z.el}`;
            
            document.getElementById('z-trait1').innerText = z.traits[0];
            document.getElementById('z-trait2').innerText = z.traits[1];
            
            // éš¨æ©Ÿç”Ÿæˆæ˜Ÿç´š
            const stars = ["â˜…â˜…â˜…â˜†â˜†", "â˜…â˜…â˜…â˜…â˜†", "â˜…â˜…â˜…â˜…â˜…"];
            const todaySeed = new Date().getDate();
            document.getElementById('z-love-star').innerText = stars[(todaySeed + index) % 3];
            document.getElementById('z-work-star').innerText = stars[(todaySeed + index + 1) % 3];
            document.getElementById('z-money-star').innerText = stars[(todaySeed + index + 2) % 3];
            
            document.getElementById('z-desc').innerText = `ã€ä»Šæ—¥æ˜Ÿèªã€‘${z.desc} å»ºè­°ç™¼æ®ä½ çš„ã€Œ${z.traits[0]}ã€ç‰¹è³ªã€‚`;
            document.getElementById('z-match').innerText = `ğŸ’˜ ä»Šæ—¥é€Ÿé…ï¼š${z.match}`;
        }

        function updateDailyView(seed) {
            const today = new Date();
            const todaySeed = today.getDate() + today.getMonth() + seed;
            const colors = ["é‡‘è‰²", "è—è‰²", "ç´…è‰²", "ç¶ è‰²", "ç™½è‰²", "é»‘è‰²", "ç´«è‰²"];
            const dirs = ["åŒ—æ–¹", "å—æ–¹", "æ±æ–¹", "è¥¿æ–¹", "æ±åŒ—", "è¥¿åŒ—"];
            
            document.getElementById('today-date').innerText = `${today.getFullYear()}/${today.getMonth()+1}/${today.getDate()}`;
            document.getElementById('d-color').innerText = colors[todaySeed % 7];
            document.getElementById('d-num').innerText = (todaySeed % 9) + 1;
            document.getElementById('d-dir').innerText = dirs[todaySeed % 6];
            
            const tips = ["ä½èª¿è¡Œäº‹ï¼Œé¿å…é‹’èŠ’å¤ªéœ²", "è²´äººé‹æ—ºï¼Œé©åˆæ±‚åŠ©é•·è¼©", "è²¡é‹ä¸éŒ¯ï¼Œä½†æ³¨æ„è¡å‹•æ¶ˆè²»", "æƒ…ç·’æ˜“æ³¢å‹•ï¼Œå»ºè­°ä¿æŒå†·éœ", "æ¡ƒèŠ±æœµæœµé–‹ï¼Œç•™æ„èº«é‚Šç•°æ€§"];
            document.getElementById('d-advice').innerHTML = `ğŸ’¡ <b>ç´«å¾®æŒ‡å¼•ï¼š</b>${tips[todaySeed % 5]}ã€‚<br>å—${currentBlood}å‹è¡€å½±éŸ¿ï¼Œè¡Œäº‹å®œ${currentBlood==='B'?'å½ˆæ€§':'ç©©é‡'}ã€‚`;
        }

        function updateLifeTimeline(category) {
            currentLifeTab = category;
            const starInfo = starTraits[currentStar];
            const keywords = starInfo[category].split('/'); 
            const tpl = textTemplates[category];
            
            const pastText = tpl.past.replace(/{Trait}/g, keywords[0]);
            const presentText = tpl.present.replace(/{Trait}/g, keywords[1] || keywords[0]);
            const futureText = tpl.future.replace(/{Trait}/g, keywords[2] || keywords[0]);

            const doms = [document.getElementById('tl-past'), document.getElementById('tl-present'), document.getElementById('tl-future')];
            doms.forEach(el => { el.classList.remove('fade-in-text'); void el.offsetWidth; el.classList.add('fade-in-text'); });

            document.getElementById('tl-past').innerHTML = pastText;
            document.getElementById('tl-present').innerHTML = presentText;
            document.getElementById('tl-future').innerHTML = futureText;
        }

        // UI åˆ‡æ›åŠŸèƒ½
        function switchMainTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.content-view').forEach(v => v.classList.remove('active'));
            
            // æŒ‰éˆ• Active
            const idx = tab === 'daily' ? 0 : tab === 'zodiac' ? 1 : 2;
            document.querySelectorAll('.tab-btn')[idx].classList.add('active');
            
            // é é¢é¡¯ç¤º
            document.getElementById(`view-${tab}`).classList.add('active');
        }

        function switchLifeSubTab(category) {
            const buttons = document.querySelectorAll('.sub-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            const map = { 'career': 0, 'love': 1, 'family': 2, 'health': 3 };
            buttons[map[category]].classList.add('active');
            updateLifeTimeline(category);
        }

        function flipTarot() {
            if(isFlipped) return;
            isFlipped = true;
            document.getElementById('tarot-obj').classList.add('is-flipped');
            const randIndex = Math.floor(Math.random() * tarotDeck.length);
            const card = tarotDeck[randIndex];
            setTimeout(() => {
                document.getElementById('tarot-img').innerText = card.icon;
                document.getElementById('tarot-name').innerText = card.name;
                document.getElementById('tarot-desc').innerText = card.desc;
                document.getElementById('tarot-desc-box').style.display = 'block';
            }, 300);
        }

        function resetTarot(e) {
            e.stopPropagation();
            document.getElementById('tarot-obj').classList.remove('is-flipped');
            document.getElementById('tarot-desc-box').style.display = 'none';
            isFlipped = false;
        }

        document.getElementById('birthdate').max = new Date().toISOString().split("T")[0];
    </script>
</body>
</html>